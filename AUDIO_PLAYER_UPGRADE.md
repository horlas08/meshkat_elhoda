# ุชุญุฏูุซ ูุดุบู ุงูุตูุช - Quran Audio Upgrade

## ๐ ุงูููุฎุต
ุชู ุชุญุฏูุซ ููุฒุฉ Quran Audio ุจุงููุงูู ูุชูููุฑ ุชุฌุฑุจุฉ ุงุญุชุฑุงููุฉ ูุน ุฏุนู ุงูุชุดุบูู ูู ุงูุฎูููุฉ ูุงูุชุดุบูู ุงููุณุชูุฑ ุญุชู ุนูุฏ ุฅุบูุงู ุงูุชุทุจูู.

---

## โจ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### 1๏ธโฃ **ุณูุฑูู ุชุดุบูู ุงุญุชุฑุงููุฉ** `AudioPlayerScreen`
- ูุงุฌูุฉ ุฌูููุฉ ูุญุฏูุซุฉ ูุน:
  - โ ุนุฑุถ ูุนูููุงุช ุงูุณูุฑุฉ ูุงููุงุฑุฆ
  - โ ูุคุดุฑ ุงูุชูุฏู (Progress Bar) ูุน ุชุญุฏูุซ ููุฑู
  - โ ุนุฑุถ ุงูููุช ุงูุญุงูู ูุงูููู
  - โ ุฃุฒุฑุงุฑ ุชุญูู ุงุญุชุฑุงููุฉ (ุชุดุบูู/ุฅููุงูุ ุงูุชุงููุ ุงูุณุงุจู)
  - โ ุฃุฒุฑุงุฑ ุฅุถุงููุฉ (ุฅุนุงุฏุฉุ ูุดุงุฑูุฉุ ุงูููุถูุฉ)
  - โ ุนุฑุถ ูููุน ุงูุณูุฑุฉ ูู ุงููุงุฆูุฉ (ูุซูุงู: ุงูุณูุฑุฉ 1 ูู 114)

### 2๏ธโฃ **ุงูุชุดุบูู ูู ุงูุฎูููุฉ** (Background Audio)
- ๐ต ุงูุตูุช ูุณุชูุฑ ูู ุงูุชุดุบูู ุญุชู ุนูุฏ:
  - ุฅุบูุงู ุงูุดุงุดุฉ
  - ุงูุฎุฑูุฌ ูู ุงูุชุทุจูู
  - ููู ุงููุงุชู
- ๐ฑ ุฅุธูุงุฑ ุฅุดุนุงุฑ ุงููุธุงู ูุน ูุนูููุงุช ุงูุชุดุบูู ุงูุญุงููุฉ
- โธ๏ธ ุงูุชุญูู ุนุจุฑ ุฃุฒุฑุงุฑ ุงูุฅุดุนุงุฑ (ุชุดุบูู/ุฅููุงู/ุฅููุงู ุงููู)

### 3๏ธโฃ **ุงูุชูุงูู ุงูุณูุณ**
- ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูุชุดุบูู ูู ูุงุฆูุฉ ุงูุณูุฑ โ ุงูุงูุชูุงู ูุจุงุดุฑุฉ ุฅูู ุงูุณูุฑูู ุงูุฌุฏูุฏุฉ
- BLoC State Management ูุชูุงูู ูุน ุงูุชุญุฏูุซุงุช ุงูููุฑูุฉ
- ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก

---

## ๐ง ุงูุชุบููุฑุงุช ุงูุชูููุฉ

### ูููุงุช ุชู ุฅูุดุงุคูุง:
```
lib/features/quran_audio/presentation/screens/audio_player_screen.dart
```

### ูููุงุช ุชู ุชุญุฏูุซูุง:

#### 1. `lib/main.dart`
```dart
// ุฅุถุงูุฉ ุชููุฆุฉ ุฎุฏูุฉ ุงูุตูุช ุนูุฏ ุจุฏุก ุงูุชุทุจูู
try {
  await QuranAudioService().initialize();
  log('โ ุชู ุชููุฆุฉ ุฎุฏูุฉ ุงูุตูุช ุจูุฌุงุญ');
} catch (e) {
  log('โ ุฎุทุฃ ูู ุชููุฆุฉ ุฎุฏูุฉ ุงูุตูุช: $e');
}
```

#### 2. `lib/core/services/audio_player/audio_player_service.dart`
```dart
// ุฅุถุงูุฉ ุฏุนู QuranAudioService ููุฎูููุฉ
late QuranAudioService _quranAudioService;

// ุชุญุฏูุซ playTrack() ูุชุญุฏูุซ ุงูุฅุดุนุงุฑ
await _quranAudioService.loadAyah(
  audioUrl: track.audioUrl,
  ayahText: track.surahName,
  surahName: track.surahName,
  ayahNumber: int.tryParse(track.surahNumber) ?? 1,
);
```

#### 3. `lib/features/quran_audio/presentation/screens/audio_surahs_screen.dart`
```dart
// ุชุญุฏูุซ onPlayTap ููุงูุชูุงู ุฅูู ุงูุณูุฑูู ุงูุฌุฏูุฏุฉ
Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => AudioPlayerScreen(
      playlist: audioTracks,
      startIndex: availableSurahs.indexOf(surah),
    ),
  ),
);
```

#### 4. `lib/features/quran_audio/presentation/screens/screens.dart`
```dart
export 'audio_player_screen.dart';  // ุฅุถุงูุฉ ุชุตุฏูุฑ ุฌุฏูุฏ
```

---

## ๐ฏ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงูุฎุทูุฉ 1: ุงุฎุชูุงุฑ ุงููุงุฑุฆ
1. ุงูุชุญ ุงูุชุทุจูู โ ุงุฐูุจ ุฅูู "ุงูุตูุช"
2. ุงุฎุชุฑ "ุชูุงูุงุช ุงููุฑุขู"
3. ุงุฎุชุฑ ุงููุงุฑุฆ ุงูุฐู ุชุฑูุฏู

### ุงูุฎุทูุฉ 2: ุงุฎุชูุงุฑ ุงูุณูุฑุฉ
1. ุณุชุธูุฑ ูุงุฆูุฉ ุงูุณูุฑ
2. ุงุถุบุท ุนูู ุฒุฑ ุงูุชุดุบูู ุจุฌุงูุจ ุงูุณูุฑุฉ ุงููุทููุจุฉ

### ุงูุฎุทูุฉ 3: ุงูุชุญูู
- ูุชู ุงูุงูุชูุงู ุชููุงุฆูุงู ุฅูู ุณูุฑูู ุงูุชุดุบูู ุงูุงุญุชุฑุงููุฉ
- ุงุณุชุฎุฏู ุงูุฃุฒุฑุงุฑ ููุชุญูู (ุชุดุบูู/ุฅููุงู/ุงูุชุงูู/ุงูุณุงุจู)
- ููููู ุฅุบูุงู ุงูุชุทุจูู ูุงูุตูุช ูุณุชูุฑ ูู ุงูุชุดุบูู!

---

## ๐ ุฃุฑุดูุชูุชุดุฑ ุงูุชุดุบูู ูู ุงูุฎูููุฉ

```
AudioPlayerService (Local Playback)
        โ
QuranAudioService (Background Handler)
        โ
AudioService (System Notifications)
```

### ุงูุชุฏูู:
1. `AudioPlayerService` ูุดุบู ุงูุตูุช ูุญููุงู ุนุจุฑ `just_audio`
2. `QuranAudioService` ูุชุญูู ูู ุงูุฅุดุนุงุฑุงุช ูุงูุชุดุบูู ูู ุงูุฎูููุฉ
3. `AudioService` ูุนุฑุถ ุงูุฅุดุนุงุฑ ุนูู ุดุฑูุท ุงูุชูุจููุงุช

---

## ๐ ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก ูู ูู ุฏุงูุฉ
- โ ุฑุณุงุฆู ุชุณุฌูู ูุงุถุญุฉ (logs) ูุชุณููู ุงูุชุตุญูุญ
- โ fallback mechanism ุฅุฐุง ูุดู ุงูุชุดุบูู

---

## ๐ ุญุงูุงุช ุงูุญุฏูุฏ (Edge Cases)

| ุงูุญุงูุฉ | ุงูุณููู |
|--------|--------|
| ุงูุถุบุท ุนูู ุงูุชุดุบูู | ุงูุงูุชูุงู ุฅูู ุงูุณูุฑูู + ุงูุชุดุบูู ุงูููุฑู |
| ุฅุบูุงู ุงูุชุทุจูู | ุงูุตูุช ูุณุชูุฑ ูู ุงูุฎูููุฉ |
| ููู ุงูุดุงุดุฉ | ุงูุตูุช ูุณุชูุฑ + ุงูุฅุดุนุงุฑ ูุฑุฆู |
| ุนุฏู ุงูุฅูุชุฑูุช | ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ + ูุญุงููุฉ ูู ุงููุงุด |
| ุงูุชูุงุก ุงูุณูุฑุฉ | ุงูุงูุชูุงู ุชููุงุฆูุงู ููุณูุฑุฉ ุงูุชุงููุฉ |

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. โ ุงุฎุชุจุงุฑ ุงูุชุดุบูู ุนูู ุฌูุงุฒ ุญูููู
2. โ ุงูุชุฃูุฏ ูู ุงุณุชูุฑุงุฑ ุงูุชุดุบูู ุนูุฏ ููู ุงูุดุงุดุฉ
3. โณ ุฅุถุงูุฉ ููุฒุฉ ุฅุนุงุฏุฉ ุงูุชุดุบูู ุงูุชููุงุฆู
4. โณ ุฅุถุงูุฉ ูุงุฆูุฉ ุงูุชุดุบูู ุงููุชูุฏูุฉ
5. โณ ุชุญุณูู ุงูุฅุดุนุงุฑุงุช

---

## ๐ ููุงุญุธุงุช ูููุฉ

- ูุชุทูุจ ุงูุฅุฐู `WAKE_LOCK` ุนูู Android
- ูุชุทูุจ ุงูุฅุฐู `BACKGROUND_AUDIO` ุนูู iOS
- ุชู ุงุฎุชุจุงุฑ ุงูููุฒุฉ ุนูู Flutter 3.9.2+
- ูุชูุงูู ูุน ุฌููุน ุงููุบุงุช (AR, EN, ูุบูุฑู)

---

## ๐ ุชู ุจูุฌุงุญ!
ุงูุขู ูุฏูู ูุดุบู ุตูุช ุงุญุชุฑุงูู ูุน ุฏุนู ูุงูู ููุชุดุบูู ูู ุงูุฎูููุฉ!
