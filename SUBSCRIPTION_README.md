# ูุธุงู ุงูุงุดุชุฑุงูุงุช - ููุฎุต ุดุงูู

## โ ูุง ุชู ุฅูุฌุงุฒู

### 1. ุงูุจููุฉ ุงูุชุญุชูุฉ ููููุฏ

#### ุฃ. ุงูุฎุฏูุงุช (Services)
- โ **InAppPurchaseService** (`lib/core/services/in_app_purchase_service.dart`)
  - ุชููุฆุฉ ูุธุงู ุงูุดุฑุงุก ุฏุงุฎู ุงูุชุทุจูู
  - ุฌูุจ ูุงุฆูุฉ ุงูููุชุฌุงุช ุงููุชุงุญุฉ
  - ุชูููุฐ ุนูููุงุช ุงูุดุฑุงุก
  - ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช ุงูุณุงุจูุฉ
  - ุงูุงุณุชูุงุน ูุชุญุฏูุซุงุช ุงูุดุฑุงุก

#### ุจ. ุทุจูุฉ ุงูุจูุงูุงุช (Data Layer)
- โ **SubscriptionRepository** - ุชู ุชุญุฏูุซู ุจุงูุฏูุงู ุงูุชุงููุฉ:
  - `getProducts()`: ุฌูุจ ุงูููุชุฌุงุช
  - `buyProduct()`: ุดุฑุงุก ููุชุฌ
  - `restorePurchases()`: ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช
  - `purchaseStream`: ุงุณุชูุงุน ูุชุญุฏูุซุงุช ุงูุดุฑุงุก

- โ **SubscriptionLocalDataSource** - ุชู ุฅุถุงูุฉ:
  - `saveSubscription()`: ุญูุธ ุญุงูุฉ ุงูุงุดุชุฑุงู ูู Firebase

#### ุฌ. ุทุจูุฉ ุงูุนุฑุถ (Presentation Layer)
- โ **SubscriptionBloc** - ุชู ุชุญุฏูุซู ุจุงูุฃุญุฏุงุซ ูุงูุญุงูุงุช ุงูุชุงููุฉ:
  - **ุงูุฃุญุฏุงุซ**:
    - `LoadProductsEvent`: ุชุญููู ุงูููุชุฌุงุช
    - `BuySubscriptionEvent`: ุดุฑุงุก ุงุดุชุฑุงู
    - `RestorePurchasesEvent`: ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช
    - `ProcessPurchaseEvent`: ูุนุงูุฌุฉ ูุชูุฌุฉ ุงูุดุฑุงุก
  
  - **ุงูุญุงูุงุช**:
    - `SubscriptionLoaded`: ุชุญุชูู ุงูุขู ุนูู ูุงุฆูุฉ ุงูููุชุฌุงุช
    - `PurchaseProcessing`: ุญุงูุฉ ูุนุงูุฌุฉ ุงูุดุฑุงุก
    - `SubscriptionError`: ุญุงูุฉ ุงูุฎุทุฃ

#### ุฏ. ุงูุชููุฆุฉ
- โ ุชู ุฅุถุงูุฉ ุชููุฆุฉ `InAppPurchaseService` ูู `main.dart`
- โ ุชู ุชุณุฌูู ุงูุฎุฏูุฉ ูู `service_locator.dart`

### 2. ุงูููุชุฌุงุช ุงููุนุฑููุฉ

| ุงูููุชุฌ | Product ID | ุงูุณุนุฑ | ุงููุฏุฉ |
|--------|-----------|-------|-------|
| ุงุดุชุฑุงู ุดูุฑู | `monthly_subscription` | $2.99 | ุดูุฑ ูุงุญุฏ |
| ุงุดุชุฑุงู ุณููู | `yearly_subscription` | $19.99 | ุณูุฉ ูุงุญุฏุฉ |

### 3. ุงููููุงุช ุงููููุดุฃุฉ

1. **IAP_SETUP_GUIDE.md**: ุฏููู ุดุงูู ูุฅุนุฏุงุฏ ุงูุงุดุชุฑุงูุงุช ูู Google Play ู App Store
2. **ูุฐุง ุงูููู (README.md)**: ููุฎุต ุดุงูู ูููุดุฑูุน

## ๐ง ุงูุฎุทูุงุช ุงููุทููุจุฉ ูุฅููุงู ุงูุฅุนุฏุงุฏ

### ุฎุทูุงุช ุฎุงุฑุฌ ุงูุชุทุจูู (ูุทููุจุฉ)

#### 1. Google Play Console
```
โ ุฅูุดุงุก ุญุณุงุจ Google Play Developer (99$ ุฑุณูู ููุฑุฉ ูุงุญุฏุฉ)
โ ุฅูุดุงุก ุงูุชุทุจูู ูู Console
โ ุฑูุน ูุณุฎุฉ APK/AAB ููุงุฎุชุจุงุฑ
โ ุฅูุดุงุก ููุชุฌ ุงูุงุดุชุฑุงู ุงูุดูุฑู (monthly_subscription)
โ ุฅูุดุงุก ููุชุฌ ุงูุงุดุชุฑุงู ุงูุณููู (yearly_subscription)
โ ุฅุนุฏุงุฏ ุงูุญุณุงุจ ุงููุงูู ูุงุณุชูุงู ุงูุฃุฑุจุงุญ
โ ุฅุถุงูุฉ ุญุณุงุจุงุช ุงุฎุชุจุงุฑ (License Testing)
```

#### 2. App Store Connect
```
โ ุฅูุดุงุก ุญุณุงุจ Apple Developer (99$ ุณูููุงู)
โ ุฅูุดุงุก ุงูุชุทุจูู ูู App Store Connect
โ ุฅูุดุงุก Subscription Group
โ ุฅูุดุงุก ููุชุฌ ุงูุงุดุชุฑุงู ุงูุดูุฑู (monthly_subscription)
โ ุฅูุดุงุก ููุชุฌ ุงูุงุดุชุฑุงู ุงูุณููู (yearly_subscription)
โ ุฅุนุฏุงุฏ ุงูุญุณุงุจ ุงููุงูู ูุงูุถุฑุงุฆุจ
โ ุฅุถุงูุฉ Sandbox Testers ููุงุฎุชุจุงุฑ
```

### ุฎุทูุงุช ุฏุงุฎู ุงูุชุทุจูู (ุงุฎุชูุงุฑูุฉ ููู ููุตู ุจูุง)

```
โ ุฅุถุงูุฉ ูุงุฌูุฉ ูุณุชุฎุฏู ูุนุฑุถ ุงูููุชุฌุงุช
โ ุฅุถุงูุฉ ุฒุฑ "ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช"
โ ุฅุถุงูุฉ ุดุงุดุฉ ุชุฃููุฏ ุงูุดุฑุงุก
โ ุฅุถุงูุฉ ุฑุณุงุฆู ูุฌุงุญ/ูุดู ุงูุดุฑุงุก
โ ุชุญุฏูุซ UI ูุนุฑุถ ุญุงูุฉ ุงูุงุดุชุฑุงู ุงูุญุงููุฉ
โ ุฅุถุงูุฉ Server-side verification (ููุฃูุงู)
```

## ๐ฑ ููููุฉ ุงูุงุณุชุฎุฏุงู ูู ุงูููุฏ

### ูุซุงู: ุนุฑุถ ุงูููุชุฌุงุช ูุดุฑุงุก ุงุดุชุฑุงู

```dart
// ูู ุฃู Widget
class SubscriptionPage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return BlocBuilder<SubscriptionBloc, SubscriptionState>(
      builder: (context, state) {
        if (state is SubscriptionLoaded) {
          return ListView.builder(
            itemCount: state.products.length,
            itemBuilder: (context, index) {
              final product = state.products[index];
              return ListTile(
                title: Text(product.title),
                subtitle: Text(product.description),
                trailing: Text(product.price),
                onTap: () {
                  // ุดุฑุงุก ุงูููุชุฌ
                  context.read<SubscriptionBloc>().add(
                    BuySubscriptionEvent(product),
                  );
                },
              );
            },
          );
        }
        return QuranLottieLoading();
      },
    );
  }
}

// ุชุญููู ุงูููุชุฌุงุช ุนูุฏ ูุชุญ ุงูุตูุญุฉ
@override
void initState() {
  super.initState();
  context.read<SubscriptionBloc>().add(LoadProductsEvent());
}
```

### ูุซุงู: ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช

```dart
ElevatedButton(
  onPressed: () {
    context.read<SubscriptionBloc>().add(RestorePurchasesEvent());
  },
  child: Text('ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช'),
)
```

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ูุญูู (ูุจู ุงููุดุฑ)
1. **Android**: ุงุณุชุฎุฏู ุญุณุงุจุงุช License Testing
2. **iOS**: ุงุณุชุฎุฏู Sandbox Testers ุนูู ุฌูุงุฒ ุญูููู

### ููุงุท ุงูุงุฎุชุจุงุฑ ุงููููุฉ
- โ ุชุญููู ุงูููุชุฌุงุช ุจูุฌุงุญ
- โ ุนุฑุถ ุงูุฃุณุนุงุฑ ุงูุตุญูุญุฉ
- โ ุฅุชูุงู ุนูููุฉ ุงูุดุฑุงุก
- โ ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช ุงูุณุงุจูุฉ
- โ ุงูุชุนุงูู ูุน ุงูุฃุฎุทุงุก (ุฅูุบุงุก ุงูุดุฑุงุกุ ูุดู ุงูุดุจูุฉุ ุฅูุฎ)
- โ ุชุญุฏูุซ ุญุงูุฉ ุงูุงุดุชุฑุงู ุจุนุฏ ุงูุดุฑุงุก

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### ุงูุฃูุงู
- ๐ **ุงูุชุญูู ูู ุงูุฎุงุฏู**: ุญุงููุงูุ ุงูุชุทุจูู ูุซู ุจุงูุฅูุตุงูุงุช ูุญููุงู. ูู ุงูุฅูุชุงุฌุ ูุฌุจ ุงูุชุญูู ูู ุตุญุฉ ุงูุฅูุตุงูุงุช ุนุจุฑ ุงูุฎุงุฏู.
- ๐ **ุชุฎุฒูู ุขูู**: ูุนูููุงุช ุงูุงุดุชุฑุงู ูุญููุธุฉ ูู Firebase. ุชุฃูุฏ ูู ุฅุนุฏุงุฏุงุช ุงูุฃูุงู ุงูุตุญูุญุฉ.

### ุงูุฅูุบุงุก ูุงูุงุณุชุฑุฌุงุน
- ุงููุณุชุฎุฏููู ููุบูู ุงูุงุดุชุฑุงูุงุช ูู:
  - **Android**: Google Play Store > ุงูุงุดุชุฑุงูุงุช
  - **iOS**: Settings > Apple ID > Subscriptions
- ุงูุชุทุจูู ูุง ูุชุญูู ูู ุงูุฅูุบุงุก ูุจุงุดุฑุฉ

### ุงูุชุฌุฏูุฏ ุงูุชููุงุฆู
- ุงูุงุดุชุฑุงูุงุช ุชุชุฌุฏุฏ ุชููุงุฆูุงู ูุง ูู ููุบููุง ุงููุณุชุฎุฏู
- ูุฌุจ ุชุญุฏูุซ ุญุงูุฉ ุงูุงุดุชุฑุงู ุฏูุฑูุงู ููุชุญูู ูู ุงูุตูุงุญูุฉ

## ๐ ุชุฏูู ุนูููุฉ ุงูุดุฑุงุก

```
1. ุงููุณุชุฎุฏู ููุชุญ ุตูุญุฉ ุงูุงุดุชุฑุงูุงุช
   โ
2. ุงูุชุทุจูู ูุญูู ุงูููุชุฌุงุช ูู Store
   โ
3. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ููุชุฌ ููุถุบุท "ุงุดุชุฑู"
   โ
4. ูุธูุฑ ูุงูุฐุฉ ุงูุฏูุน ูู Google/Apple
   โ
5. ุงููุณุชุฎุฏู ูุคูุฏ ุงูุดุฑุงุก
   โ
6. Store ูุนุงูุฌ ุงูุฏูุน
   โ
7. ุงูุชุทุจูู ูุณุชูู ุฅุดุนุงุฑ ุจูุฌุงุญ ุงูุดุฑุงุก
   โ
8. ุงูุชุทุจูู ูุญูุธ ุญุงูุฉ ุงูุงุดุชุฑุงู ูู Firebase
   โ
9. ุงูุชุทุจูู ูููุนูู ุงูููุฒุงุช ุงููุฏููุนุฉ
```

## ๐ ุฑูุงุจุท ูููุฏุฉ

- [Google Play Console](https://play.google.com/console)
- [App Store Connect](https://appstoreconnect.apple.com)
- [in_app_purchase Package](https://pub.dev/packages/in_app_purchase)
- [Google Play Billing Docs](https://developer.android.com/google/play/billing)
- [Apple IAP Docs](https://developer.apple.com/in-app-purchase/)

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู:
1. ุฑุงุฌุน `IAP_SETUP_GUIDE.md` ููุชุนูููุงุช ุงูุชูุตูููุฉ
2. ุชุญูู ูู Logs ูู Android Studio/Xcode
3. ุชุฃูุฏ ูู ูุทุงุจูุฉ Product IDs ูู ุงูููุฏ ูุงูู Store Consoles
4. ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู ุญุณุงุจุงุช ุงูุงุฎุชุจุงุฑ ุงูุตุญูุญุฉ

## โ ูุงุฆูุฉ ุงูุชุญูู ุงูุณุฑูุนุฉ

### ูุจู ุงููุดุฑ
- [ ] ุชู ุฅูุดุงุก ุงูููุชุฌุงุช ูู Google Play Console
- [ ] ุชู ุฅูุดุงุก ุงูููุชุฌุงุช ูู App Store Connect
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุดุฑุงุก ุนูู Android
- [ ] ุชู ุงุฎุชุจุงุฑ ุงูุดุฑุงุก ุนูู iOS
- [ ] ุชู ุงุฎุชุจุงุฑ ุงุณุชุนุงุฏุฉ ุงููุดุชุฑูุงุช
- [ ] ุชู ุฅุนุฏุงุฏ ุงูุญุณุงุจุงุช ุงููุงููุฉ
- [ ] ุชู ูุฑุงุฌุนุฉ ุณูุงุณุฉ ุงูุฎุตูุตูุฉ (ูุฌุจ ุฐูุฑ ุงูุงุดุชุฑุงูุงุช)
- [ ] ุชู ุฅุถุงูุฉ ุดุฑูุท ุงูุงุณุชุฎุฏุงู

### ุจุนุฏ ุงููุดุฑ
- [ ] ูุฑุงูุจุฉ ุชูุงุฑูุฑ ุงูุงุดุชุฑุงูุงุช ูู Console
- [ ] ูุชุงุจุนุฉ ุดูุงูู ุงููุณุชุฎุฏููู
- [ ] ุชุญุฏูุซ ุงูุฃุณุนุงุฑ ุญุณุจ ุงูุณูู
- [ ] ุฅุถุงูุฉ ุนุฑูุถ ุชุฑููุฌูุฉ (ุงุฎุชูุงุฑู)

---

**ุชู ุฅูุดุงุก ูุฐุง ุงููุธุงู ุจูุงุณุทุฉ**: Meshkat Elhoda Development Team
**ุงูุชุงุฑูุฎ**: 2025-11-30
**ุงูุฅุตุฏุงุฑ**: 1.0.0
